# 動的アンチパターンモデルに基づく統計的背景逸脱検出手法 

**―ONDEアルゴリズムを用いた音楽イベント抽出の新展開―**

---

## 概要（Abstract）
本研究では、音楽イベント検出の新たな枠組みとして、**動的アンチパターンモデル**と呼ばれる確率的背景推定法を提案する。具体的には、音響信号から算出される特徴量の背後にある“背景的”な振る舞いをオンライン更新しながら、これと顕著に逸脱した箇所をイベントと判定する「**ONDE（Online Novelty Detection for Events）アルゴリズム**」を設計する。ONDEは単一パラメータ\(\Theta\)を軸として閾値や動的モデルの更新率を一元的に制御できる点が特徴である。このシンプルさにより、同アルゴリズムは応用範囲が広く、時間スケールが大きく異なる音楽的イベント（瞬間的パーカッションから長い持続音まで）を一貫して捉えることが可能となった。アルゴリズムの設計思想と原理的考察から、既存手法にはない高い汎用性とリアルタイム性を有することが示唆される。

---

## 1. はじめに（Introduction）
音楽信号からオンセットやオフセット、ピッチなどのイベントを抽出する問題は、MIR（Music Information Retrieval）や信号処理、さらにはヒューマン・コンピュータインタラクションの観点からも非常に重要である。従来は、フレーム間のエネルギー変化や位相情報を利用した差分ベースの手法、機械学習モデルを用いた手法などが広く研究されてきた。しかし、これらの手法には複数の閾値やパラメータ調整が必要な場合が多く、音楽ジャンルや音響環境の多様性に対して一貫した性能を得にくいという課題が存在する。

一方で、動的に計算される“背景”モデルとの逸脱度合いを基準とする「ノベルティ検出（Novelty Detection）」の枠組みは、時系列解析や画像解析、異常検知等の領域で高い汎用性を示している。しかし、音楽信号においては周波数成分の変化やイベントの持続時間が多岐にわたり、単に時間方向の統計量を追うだけでは不十分な場合が多い。

そこで本研究では、新たなノベルティ検出アプローチとして**ONDEアルゴリズム**を提案する。ONDEは、**動的アンチパターンモデル**と呼ぶ確率的バックグラウンド推定法をコアとして設計され、音楽信号の背景的・定常的な振る舞いをオンライン更新しつつ、それを逸脱する部分を高感度に検出する。さらに、アルゴリズムを単一パラメータ\(\Theta\)により制御することで、多数のハイパーパラメータに煩わされることなく柔軟に応用できることを目指している。

---

## 2. 関連研究（Related Work）
### 2.1 オンセット検出手法
従来のオンセット検出手法は、フレーム間エネルギー増加量や高周波成分の変化を強調する差分ベースの手法が代表的である。また、近年では機械学習技術の進展に伴い、畳み込みニューラルネットワーク（CNN）やリカレントニューラルネットワーク（RNN）を活用してオンセット位置を高精度に推定するアプローチも提案されている。ただし、これらMLベース手法は学習データに依存しやすく、汎化性やリアルタイム性の面で制約を受けることがある。

### 2.2 ノベルティ検出と背景モデル
ノベルティ検出（Novelty Detection）は、正常（背景）パターンの分布を何らかの方法で学習・定義し、それと著しく異なるパターンを“新規”または“異常”とみなす技術として広範に利用されている。音楽信号にも応用可能な枠組みではあるが、周波数構造と時間スケールが極めて多様な楽音に対しては、通常の単変量時系列モデルや単純なガウス分布による背景推定では十分な性能を確保できない場合が多い。

以上を踏まえ、本研究では**動的アンチパターンモデル**として、音声信号の特徴量を強力に集約しつつオンライン更新に対応した手法を構築する。そのうえで、背景からの逸脱量を計算し、音楽シグナル特有の短時間イベントから長時間の持続音までを統一的に扱えるアルゴリズムを提案する。

---

## 3. 提案手法：ONDEアルゴリズム（Methodology）

### 3.1 アルゴリズムの概念
ONDEアルゴリズムは、フレーム単位に区切った音響信号のスペクトラム（CQTなど）を用いて**代表値**と呼ぶ単一スカラー量を計算し、それをオンラインで**背景モデル**として学習した平均\(\mu\)と分散\(\sigma^2\)からの逸脱度合いによりイベント検出を行う。これを「動的アンチパターンモデル」と呼ぶ理由は、音楽信号における“背景”を適切に更新しつつ、そこに含まれない（あるいは非常に稀な）変化を瞬時に捉えるためである。

### 3.2 代表値の設計
各フレームの振幅スペクトル\(\mathbf{A}_n = (A_{n,1}, A_{n,2}, \ldots, A_{n,M})\)（\(M\)は周波数ビン数）に対して、以下のような**代表値**\(r_n\)を定義する。

\[
r_n = \sum_{k=1}^{M} A_{n,k}^2 \;+\; \lambda_{\mathrm{weight}} \cdot \bigl(\text{Top-}K\text{の平均}\bigr),
\]

すなわち、全周波数ビンのエネルギー総和と、その中でも特にエネルギーが大きい上位ビンの平均値を組み合わせる。これにより、音量の大きな単音もしくは複数ピークを持つ音の検出力を高める一方で、背景ノイズ程度の低エネルギーなフレームを相対的に小さく抑制する。

### 3.3 統計的背景逸脱の算出
求めた代表値\(\{r_n\}\)に対して、オンラインで更新されるガウスモデルを想定する。  
- **背景平均**\(\mu\)  
- **背景分散**\(\sigma^2\)

これらは以下のようにフレーム毎に更新される（\(d_t\)はフレーム時間ステップ）。

\[
\begin{align}
\mu &\leftarrow \alpha \mu + (1-\alpha)\,r_n,\\
\sigma^2 &\leftarrow \alpha\,\sigma^2 + (1-\alpha)\,(r_n - \mu)^2,
\end{align}
\]

ただし、\(\alpha\)は**イベント中の更新を抑制するロジック**が組み込まれており、通常フレームとイベント検出中フレームで異なる値を取ることができる。これにより、突発的に大きなエネルギーを持つイベントが背景モデルを急激に歪めることを防ぐ。最終的な逸脱度合いは

\[
d_n = \frac{r_n - \mu}{\sigma}
\]

として計算され、これが閾値\(T\)を超えた区間をオンイベント（発音）、再び閾値下回りを一定継続した区間をオフイベント（減衰終了）として判定する。

---

## 4. 新規性（Novelty）
本研究における新規性は以下の三点にまとめられる。

1. **単一パラメータによる大域制御**  
   提案手法では、従来の複数閾値や更新率パラメータを統合的に扱うため、**単一パラメータ\(\Theta\)**を導入した。具体的には「背景モデル更新率」「閾値スケーリング」「最小イベント長」などをすべて\(\Theta\)依存で定義することで、ユーザは\(\Theta\)のみを変化させるだけで音楽的イベントを広範囲にチューニングできる。これは、多彩な音楽ジャンルや録音条件に迅速かつ直感的に対応できる利点がある。

2. **動的アンチパターンモデルの定義**  
   通常のノベルティ検出では平均と分散をオンライン更新するだけの単純モデルが用いられることが多い。しかし、音楽信号のように多様な周波数構造を持つシグナルでは、単なる平均・分散更新だけでは過適応や誤検出を引き起こしやすい。本研究のモデルは**イベント中における更新抑制**や、和音・打楽器区間の特徴量把握など複数の仕組みを組み込み、“アンチパターン”を明示的に構築しつつ背景から外れた部分を捉える。これにより、持続的な音や微小な変動の多い環境下でも頑健なイベント抽出を実現する。

3. **モジュール型の拡張性**  
   ONDEアルゴリズムはオンセット/オフセット検出を軸としながら、検出区間の平均スペクトルを解析するモジュールを追加することで、**パーカッシブ判定、ピッチ推定、和音検出**などの高次分析を自由に拡張できる設計を採用している。これにより、単なるオンセット検出にとどまらず、より音楽的な情報（楽器種別推定、コード解析など）へ発展させる素地を備えている。

---

## 5. 結論（Conclusion）
本稿では、音楽信号からオンセット・オフセットを含むイベントを柔軟かつ高感度に検出するための新手法として、**ONDE（Online Novelty Detection for Events）アルゴリズム**を提案した。ONDEは**動的アンチパターンモデル**をコアとし、周波数スペクトルから算出される代表値とオンライン更新ガウスモデルによる背景逸脱度を組み合わせることで、短いパーカッシブ音から長く持続する旋律までをシームレスに扱うことが可能である。また、パラメータ設計を\(\Theta\)へ集約する発想により、アプリケーション現場での操作性・調整の容易性を高めている。

今後の発展としては、ライブ演奏環境での低遅延処理や多チャネル入力への拡張、確率共鳴的ノイズ注入の自動最適化などが考えられる。これらの課題に取り組むことで、ONDEアルゴリズムはリアルタイムな音楽パフォーマンス支援や大規模音楽データ解析など、より幅広い領域での展開が期待される。

---

以上に示したONDEアルゴリズムは、オンライン更新とイベント抑制機構によって安定的な背景モデルを維持しながら、あらゆる時間スケールの音楽的変動を高精度に把握する。**単一パラメータ\(\Theta\)の導入による汎用性**と**動的アンチパターンモデル**という枠組みは、今後の音楽情報処理および異常検知分野にも新たな道を拓くことが期待される。